<!DOCTYPE html>
<html lang="en">
<head>
    <title>Candidate Dashboard | HRMS</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="logo">HRMS</div>
    <a href="/auth/logout" class="btn-outline">Logout</a>
</nav>

<!-- Page Wrapper -->
<div class="page">

    <!-- Profile Card -->
    <div class="glass-card">
        <h2>Candidate Profile</h2>
        <div class="profile-info">
            <p><span>Name</span>{{ user.name }}</p>
            <p><span>Email</span>{{ user.email }}</p>
        </div>
    </div>

    <!-- Job Feed -->
    <div class="glass-card">
        <h2>Job Openings</h2>

        <!-- Filters -->
        <div class="filters">
            <input id="filterDepartment" placeholder="Department">
            <input id="filterLocation" placeholder="Location">
            <button class="btn-primary" onclick="loadJobs()">Search</button>
        </div>

        <!-- Jobs -->
        <div id="jobs" class="job-list"></div>
    </div>

</div>

<script src="/static/js/app.js"></script>

<script>
async function loadJobs() {
    const dept = document.getElementById("filterDepartment").value;
    const loc = document.getElementById("filterLocation").value;

    let url = "/candidate/jobs?";
    if (dept) url += `department=${dept}&`;
    if (loc) url += `location=${loc}`;

    const jobs = await fetch(url).then(res => res.json());
    const container = document.getElementById("jobs");
    container.innerHTML = "";

    jobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "job-card";

        div.innerHTML = `
            <h3>${job.title}</h3>
            <p><b>Department:</b> ${job.department}</p>
            <p><b>Location:</b> ${job.location}</p>
            <p><b>Vacancies:</b> ${job.vacancies}</p>
            <button class="btn-apply" onclick="applyJob(${job.id})">Apply</button>
        `;

        container.appendChild(div);
    });
}

async function applyJob(jobId) {
    const data = {
        candidate_id: {{ user.user_id }},
        job_id: jobId
    };
    const res = await postData("/candidate/apply", data);
    alert(res.message || res.error);
}

loadJobs();
</script>

</body>
</html>
